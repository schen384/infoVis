<!DOCTYPE html>
<html>
<head>

	<title>csv</title>
	<style>
	    .bar rect:hover{
        	fill: rgba(0,0,0,.8);
      	}
	</style>
	
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

</head>
<body>
	<script >

		// var array = null;
		// d3.csv("sample.csv", function(d) {
		//   return {
		//     id: d.id,
		//     message: d.message
		//   };
		// }, function(error, rows) {
		// 	array = rows;
		// });
		
		// setTimeout(function(){
		// 	console.log(array.length);
		// }, 3000);
		var width = 1000,
			height = 600,
			padding = 50;
		d3.csv("sample.csv", function(d) {
			var map = d.map(function(i) {
				return +i.id;
			})
			
			var histogram = d3.layout.histogram()
				.bins(20)
				(map)

			var y = d3.scale.linear()
				.domain([0,d3.max(histogram.map(function(i){ return i.length;}))])
				.range([0,height - 100]);

			var x = d3.scale.linear()
				.domain([0,d3.max(map)])
				.range([0,width-20]);
			console.log(d3.max(map));

			// var axisScale = d3.scale.linear()
   //                       // .domain([0,d3.max(map)])
   //                       .range([0,width]);
			var axisScale = d3.scale.ordinal()
			    .domain(d3.range(20))
			    .rangeRoundBands([0, width]);

			var xAxis = d3.svg.axis()
				.scale(axisScale)
				.orient("bottom")
				.tickSize(5)
				.tickPadding(6)
				.tickFormat(function(d) { return Math.round(d*(4859/20)); });


			var canvas = d3.select('body').append('svg')
						.attr('width',width)
						.attr('height',height + padding)
						.append('g')
						.attr("transform",'translate(20,0)');

			var group = canvas.append('g')
				.attr("transform",'translate(-20,' + height + ")")
				.call(xAxis);


			var bars = canvas.selectAll('.bar')
							.data(histogram)
							.enter()
							.append('g')
							.attr("class", "bar");

			bars.append('rect')
							.attr('x', function(data){return x(data.x);})
							.attr('y', function(data) {return 600 - y(data.y)})
							.attr('width', function(data){return x(data.dx);})
							.attr('height', function(data){return y(data.y);})
							.attr('fill', 'steelblue')
			bars.append('text')
				.attr("x", function(d) {return x(d.x);})
				.attr('y', function(d) {return 600 - y(d.y);})
				.attr('fill','#000')
				.attr('dy',"-7px")
				.attr('dx',function(d) {return x(d.dx)/2;})
				.attr('text-anchor','middle')
				.text(function(d) {return d.y;})

			console.log(histogram);
		})



	    
			

	</script>



</body>
</html>